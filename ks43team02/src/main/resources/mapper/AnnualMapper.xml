<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ks43team02.mapper.AnnualMapper">
	<resultMap type="AnnualApplication"					id="AnnualAppResultMap">
  		<id column="annual_application_code"					property="annualApplicationCode"/>
  		<result column="cp_representative_code" 				property="cpRepresentativeCode"/>
  		<result column="super_admin_id" 						property="superAdminId"/>
		<result column="cate_annual_code"						property="cateAnnualCode"/>
  		<result column="approval_request_code"					property="approvalRequestCode"/>
  		<result column="emply_id" 								property="emplyId"/>
  		<result column="emply_name" 							property="emplyName"/>
  		<result column="annual_start_date" 						property="annualStartDate"/>
  		<result column="annual_end_date" 						property="annualEndDate"/>
  		<result column="use_date" 								property="useDate"/>
  		<result column="comment" 								property="comment"/>
  		<result column="attach_file_name" 						property="attachFileName"/>
  		<result column="reg_date" 								property="regDate"/>
  		<result column="approval_name" 							property="approvalName"/>
  		<result column="group_code" 							property="groupCode"/>
  			<collection property="cateAnnual"  			ofType="CateAnnual">
				<id column="cate_annual_code"					property="cateAnnualCode"/>
				<result column="cp_representative_code" 		property="cpRepresentativeCode"/>
				<result column="super_admin_id" 				property="superAdminId"/>
				<result column="annual_division" 				property="annualDivision"/>
				<result column="cp_name" 						property="cpName"/>
				<result column="reg_date" 						property="regDate"/>
			</collection>
  			<collection property="approvalRequest"  	ofType="ApprovalRequest">
				<id column="approval_request_code"				property="approvalRequestCode"/>
			</collection>
  			<collection property="annualStandard"  		ofType="AnnualStandard">
				<id column="annual_standard_code"				property="annualStandardCode"/>
			</collection>
	</resultMap>
	<select id="getAnnualApplication" parameterType="AnnualApplication" resultMap="AnnualAppResultMap">
		/* 연차등록 */
		SELECT 
			aa.annual_application_code
			, aa.cp_representative_code
			, aa.super_admin_id
			, aa.cate_annual_code
			, aa.approval_request_code
			, aa.emply_id
			, aa.emply_name
			, aa.annual_start_date
			, aa.annual_end_date
			, aa.use_date
			, aa.`comment`
			, aa.attach_file_name
			, aa.reg_date
			, aa.approval_name
			, aa.group_code
		FROM 
			tb_annual_application AS aa
		INNER join
			tb_approval_request AS ar
		on
			aa.approval_request_code = ar.approval_request_code
		INNER join
			tb_cate_annual AS ca
		on
			aa.cate_annual_code = ca.cate_annual_code;
	</select>
		<insert id="addAnnualApplication" parameterType="AnnualApplication">
 		/* 연차등록 INSERT */
	 	INSERT INTO tb_annual_application(
	 		annual_application_code
			, cp_representative_code
			, super_admin_id
			, cate_annual_code
			, approval_request_code
			, emply_id
			, emply_name
			, annual_start_date
			, annual_end_date
			, use_date
			, `comment`
			, attach_file_name
			, reg_date
			, approval_name
			, group_code
		)VALUES (
			(SELECT CONCAT('annual_application_code_',(SELECT(Max(cast(SUBSTRING_INDEX(annual_application_code,'_',-1) AS UNSIGNED)) +1)
				from
					tb_annual_application
					aa)))
			, #{cpRepresentativeCode}
			, #{superAdminId}
			, #{cateAnnualCode}
			, 'approval_request_code_01'
			, #{emplyId}
			, #{emplyName}
			, CURDATE()
			, CURDATE()
			, #{useDate}
			, #{comment}
			, #{attachFileName}
			, CURDATE()
			, #{approvalName}
			, #{groupCode}
		);
 	</insert>
 	<select id="getAnnualList" resultMap="AnnualAppResultMap">
 		/* 연차신청 목록 리스트 */
		SELECT 
			annual_application_code
			, cp_representative_code
			, super_admin_id
			, cate_annual_code
			, approval_request_code
			, emply_id
			, emply_name
			, annual_start_date
			, annual_end_date
			, use_date
			, `comment`
			, attach_file_name
			, reg_date
			, approval_name
			, group_code
			FROM 
				tb_annual_application;
 	</select>
	<select id="getAnnualCateList" resultType="CateAnnual" parameterType="String">
		/* 연차 카테 */
		SELECT 
			 cate_annual_code 			AS cateAnnualCode
			,cp_representative_code		AS cpRepresentativeCode
			,super_admin_id				AS superAdminId
			,annual_division			AS annualDivision
			,cp_name					AS cpName
			,reg_date					AS regDate
		FROM 
			tb_cate_annual
		WHERE
			cp_representative_code = #{cpRepresentativeCode};
	</select>
	<select id="getEmplyInfoByEmail" resultType="Emply" parameterType="String">
		SELECT 
			  er.emply_id					AS emplyId					
			, er.cp_representative_code		AS cpRepresentativeCode
			, er.super_admin_id				AS superAdminId
			, er.emply_name					AS emplyName
		FROM 
			tb_emply_info_reg AS er
		WHERE
			er.emply_id = #{emplyId};
	
	</select>
 
 <!-- 	<select id="getAnnualListLogin" parameterType="AnnualListLogin" resultMap="AnnualAppResultMap">
 		 /* 로그인한 사원 연차 신청 리스트 */
		SELECT
			aa.annual_application_code		AS annualApplicationCode
			,aa.cp_representative_code		AS cpRepresentativeCode
			,aa.super_admin_id				AS superAdminId
			,aa.cate_annual_code			AS cateAnnualCode
			,aa.approval_request_code		AS approvalRequestCode
			,aa.emply_id					AS emplyId
			,aa.emply_name					AS emplyName
			,aa.annual_start_date			AS annualStartDate
			,aa.annual_end_date				AS annualEndDate
			,aa.use_date					AS useDate
			,aa.`comment`					AS `comment`
			,aa.attach_file_name			AS attachFileName
			,aa.reg_date					AS regDate
			,aa.group_code					AS groupCode
		FROM
			tb_annual_application AS aa
		INNER JOIN
			tb_emply_info_reg AS ei
		ON
			aa.emply_id = ei.emply_id
		WHERE
			ei.emply_id = #{emplyId}
		GROUP BY
			aa.annual_application_code;
 	</select> -->
 
<!--  	<select id="delAnnualList" parameterType="String">
 	/* 연차 신청 리스트 삭제 */
 	DELETE 
	FROM 
		tb_annual_application 
	WHERE 
		annual_application_code=#{annualApplicationCode}
 	</select> -->
 	
</mapper>